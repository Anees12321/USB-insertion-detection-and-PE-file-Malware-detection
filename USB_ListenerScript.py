import wmi
import subprocess


def on_usb_insertion():
    # Run your Python script when USB is inserted
    subprocess.run(["python", "Main.py"])


def main():
    # Initialize WMI
    c = wmi.WMI()
    raw_wql = "SELECT * FROM __InstanceCreationEvent WITHIN 2 WHERE TargetInstance ISA 'Win32_USBHub'"
    watcher = c.watch_for(raw_wql=raw_wql)

    # Start listening for USB insertions
    while True:
        usb_event = watcher()
        if usb_event:
            print("USB Inserted")
            on_usb_insertion()


if __name__ == "__main__":
    main()

